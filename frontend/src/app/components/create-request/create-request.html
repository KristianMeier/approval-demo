<!-- src/app/components/create-request/create-request.html -->
<div class="create-request">
    <!-- Success/Error Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
        âœ… {{ successMessage }}
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">
        âŒ {{ errorMessage }}
    </div>

    <!-- Main Form -->
    <form [formGroup]="requestForm" (ngSubmit)="onSubmit()">

        <!-- Title -->
        <div class="form-group">
            <label for="title" class="form-label">Titel *</label>
            <input type="text" id="title" class="form-control" formControlName="title"
                placeholder="F.eks. Nyt kontorudstyr, IT-udstyr, rejsegodkendelse..."
                [class.is-invalid]="requestForm.get('title')?.invalid && requestForm.get('title')?.touched">
            <div *ngIf="requestForm.get('title')?.invalid && requestForm.get('title')?.touched"
                class="invalid-feedback">
                Titel er pÃ¥krÃ¦vet
            </div>
        </div>

        <!-- Description -->
        <div class="form-group">
            <label for="description" class="form-label">Beskrivelse *</label>
            <textarea id="description" class="form-control" formControlName="description" rows="4"
                placeholder="Detaljeret beskrivelse af anmodningen, begrundelse, specifikationer..."
                [class.is-invalid]="requestForm.get('description')?.invalid && requestForm.get('description')?.touched"></textarea>
            <div *ngIf="requestForm.get('description')?.invalid && requestForm.get('description')?.touched"
                class="invalid-feedback">
                Beskrivelse er pÃ¥krÃ¦vet
            </div>
        </div>

        <!-- Category and Priority Row -->
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="category" class="form-label">Kategori *</label>
                    <select id="category" class="form-control" formControlName="category"
                        [class.is-invalid]="requestForm.get('category')?.invalid && requestForm.get('category')?.touched">
                        <option value="">VÃ¦lg kategori</option>
                        <option value="IT">ğŸ–¥ï¸ IT & Teknologi</option>
                        <option value="IndkÃ¸b">ğŸ›’ IndkÃ¸b & Procurement</option>
                        <option value="HR">ğŸ‘¥ Personal & HR</option>
                        <option value="Ã˜konomi">ğŸ’° Ã˜konomi & Budget</option>
                        <option value="Drift">ğŸ”§ Drift & Vedligeholdelse</option>
                        <option value="Rejse">âœˆï¸ Rejse & Transport</option>
                        <option value="Uddannelse">ğŸ“š Uddannelse & Kurser</option>
                        <option value="Andet">ğŸ“‹ Andet</option>
                    </select>
                    <div *ngIf="requestForm.get('category')?.invalid && requestForm.get('category')?.touched"
                        class="invalid-feedback">
                        Kategori er pÃ¥krÃ¦vet
                    </div>
                </div>
            </div>

            <div class="form-col">
                <div class="form-group">
                    <label for="priority" class="form-label">Prioritet *</label>
                    <select id="priority" class="form-control" formControlName="priority">
                        <option value="low">ğŸŸ¢ Lav - Ikke kritisk</option>
                        <option value="medium">ğŸŸ¡ Mellem - Normal hastighed</option>
                        <option value="high">ğŸŸ  HÃ¸j - Vigtigt</option>
                        <option value="urgent">ğŸ”´ Akut - Kritisk</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Amount and Due Date Row -->
        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="amount" class="form-label">BelÃ¸b (DKK)</label>
                    <input type="number" id="amount" class="form-control" formControlName="amount" placeholder="0"
                        min="0" step="1"
                        [class.is-invalid]="requestForm.get('amount')?.invalid && requestForm.get('amount')?.touched">
                    <small class="form-text">Lad stÃ¥ tom hvis ikke relevant</small>
                    <div *ngIf="requestForm.get('amount')?.invalid && requestForm.get('amount')?.touched"
                        class="invalid-feedback">
                        BelÃ¸b skal vÃ¦re positivt
                    </div>
                </div>
            </div>

            <div class="form-col">
                <div class="form-group">
                    <label for="due_date" class="form-label">Ã˜nsket frist</label>
                    <input type="date" id="due_date" class="form-control" formControlName="due_date" [min]="minDate">
                    <small class="form-text">HvornÃ¥r skal dette vÃ¦re fÃ¦rdigt?</small>
                </div>
            </div>
        </div>

        <!-- Approver Selection -->
        <div class="form-group">
            <label for="approver" class="form-label">Godkender *</label>
            <select id="approver" class="form-control" formControlName="approver_id"
                [class.is-invalid]="requestForm.get('approver_id')?.invalid && requestForm.get('approver_id')?.touched">
                <option value="">VÃ¦lg godkender</option>
                <option *ngFor="let user of users" [value]="user.id">
                    {{ user.name }} - {{ user.role }}
                    <span *ngIf="user.department">({{ user.department }})</span>
                </option>
            </select>
            <div *ngIf="requestForm.get('approver_id')?.invalid && requestForm.get('approver_id')?.touched"
                class="invalid-feedback">
                Godkender er pÃ¥krÃ¦vet
            </div>
            <small class="form-text">VÃ¦lg den person der skal godkende denne anmodning</small>
        </div>

        <!-- External Reference (Optional) -->
        <div class="form-group">
            <label for="external_reference" class="form-label">Ekstern reference</label>
            <input type="text" id="external_reference" class="form-control" formControlName="external_reference"
                placeholder="F.eks. sagsnummer, fakturanummer, kontrakt ID...">
            <small class="form-text">Valgfrit - reference til eksisterende sager eller dokumenter</small>
        </div>

        <!-- Confidentiality Level -->
        <div class="form-group">
            <label for="confidentiality_level" class="form-label">Fortrolighedsniveau</label>
            <select id="confidentiality_level" class="form-control" formControlName="confidentiality_level">
                <option value="normal">ğŸ”“ Normal - Standard adgang</option>
                <option value="confidential">ğŸ”’ Fortroligt - BegrÃ¦nset adgang</option>
                <option value="secret">ğŸ” Hemmeligt - HÃ¸jeste sikkerhed</option>
            </select>
            <small class="form-text">VÃ¦lg passende sikkerhedsniveau for denne anmodning</small>
        </div>

        <!-- Submit Button -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-lg" [disabled]="!requestForm.valid || submitting">
                <span *ngIf="submitting">â³ Opretter...</span>
                <span *ngIf="!submitting">ğŸ“¤ Opret Godkendelsesanmodning</span>
            </button>

            <button type="button" class="btn btn-secondary btn-lg" (click)="resetForm()" [disabled]="submitting">
                ğŸ”„ Nulstil
            </button>
        </div>

        <!-- Form Validation Summary -->
        <div *ngIf="!requestForm.valid && requestForm.touched" class="alert alert-warning mt-3">
            <strong>âš ï¸ Manglende oplysninger:</strong>
            <ul class="mb-0 mt-2">
                <li *ngIf="requestForm.get('title')?.invalid">Titel er pÃ¥krÃ¦vet</li>
                <li *ngIf="requestForm.get('description')?.invalid">Beskrivelse er pÃ¥krÃ¦vet</li>
                <li *ngIf="requestForm.get('category')?.invalid">Kategori skal vÃ¦lges</li>
                <li *ngIf="requestForm.get('approver_id')?.invalid">Godkender skal vÃ¦lges</li>
                <li *ngIf="requestForm.get('amount')?.invalid">BelÃ¸b skal vÃ¦re positivt (eller tomt)</li>
            </ul>
        </div>
    </form>

    <!-- Quick Actions Section -->
    <div class="quick-actions-section">
        <div class="card">
            <div class="card-header">
                <h4>ğŸš€ Hurtig Start</h4>
            </div>
            <div class="card-body">
                <p>Mangler test data? Opret hurtig test setup:</p>
                <div class="d-flex gap-2">
                    <button (click)="createTestUsers()" class="btn btn-outline btn-sm" [disabled]="creatingTestData">
                        <span *ngIf="creatingTestData">â³</span>
                        <span *ngIf="!creatingTestData">ğŸ‘¥</span>
                        Opret Test Brugere
                    </button>

                    <button (click)="fillSampleData()" class="btn btn-outline btn-sm">
                        ğŸ“ Udfyld Eksempel Data
                    </button>

                    <button (click)="viewFormHelp()" class="btn btn-outline btn-sm">
                        â“ HjÃ¦lp
                    </button>
                </div>
                <small class="text-muted d-block mt-2">
                    Test brugere: Manager Jensen (godkender) og Medarbejder Hansen (anmoder)
                </small>
            </div>
        </div>
    </div>
</div>